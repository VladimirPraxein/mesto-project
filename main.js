(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("mousedown",(function(r){r.target.closest(".popup__container")||t(e),r.target.closest(".popup__button-close")&&t(e)}))}));var o={formClass:".popup__form",fieldsetClass:".popup__form-info",inputClass:".popup__form-input",buttonClass:".popup__button-save",buttonInactiveClass:"popup__button-save_inactive",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__form-error_active"};function n(e,t,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""}function a(e,t){var r=e.querySelector(t.formClass);Array.from(r.querySelectorAll(t.inputClass)).forEach((function(e){n(r,e,t)}))}function c(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.buttonInactiveClass),t.removeAttribute("disabled","")):(t.classList.add(r.buttonInactiveClass),t.setAttribute("disabled",""))}function u(e,t){c(Array.from(e.querySelectorAll(t.inputClass)),e.querySelector(t.buttonClass),t)}var s=document.querySelector(".grid-cards__template").content,i=document.querySelector(".popup_type_image"),l=i.querySelector(".popup_type_image__image"),d=i.querySelector(".popup_type_image__text");function p(e,t){e.textContent=t.length}function _(t,r){var o=s.querySelector(".grid-cards__item").cloneNode(!0),n=o.querySelector(".grid-cards__image"),a=o.querySelector(".grid-cards__delete-button"),c=o.querySelector(".grid-cards__like-button"),u=o.querySelector(".grid-cards__like-number");return o.querySelector(".grid-cards__title").textContent=t.name,n.src=t.link,n.alt=t.name,n.addEventListener("click",(function(){l.src=t.link,l.alt=t.name,d.textContent=t.name,e(i)})),p(u,t.likes),t.likes.find((function(e){return e._id===r}))&&c.classList.add("grid-cards__like-button_active"),t.owner._id===r&&a.classList.add("grid-cards__delete-button_active"),c.addEventListener("click",(function(e){e.target.classList.toggle("grid-cards__like-button_active"),e.target.classList.contains("grid-cards__like-button_active")?function(e,t,r){fetch("".concat(m.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:m.headers,body:JSON.stringify({likes:t})}).then(b).then((function(e){p(r,e.likes)})).catch(q)}(t._id,t.likes,u):function(e,t){fetch("".concat(m.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:m.headers}).then(b).then((function(e){p(t,e.likes)})).catch(q)}(t._id,u)})),a.addEventListener("click",(function(e){var r;e.target.closest(".grid-cards__item").remove(),r=t._id,fetch("".concat(m.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:m.headers}).then(b).catch(q)})),o}var f,m={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"28d7f0d3-a669-484f-a111-3c43e10b44aa","Content-Type":"application/json"}},v=document.querySelector(".profile__name"),y=document.querySelector(".profile__work"),h=document.querySelector(".profile__avatar"),S=document.querySelector(".grid-cards__list");function b(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function q(e){console.log(e)}function C(e){v.textContent=e.name,y.textContent=e.about,h.src=e.avatar}function g(e,t){e?(t.textContent="Сохранение...",t.disabled=!0):(t.classList.contains("button-create")?t.textContent="Создать":t.textContent="Сохранить",t.disabled=!1)}var k=document.querySelector(".popup_type_profile"),E=document.querySelector(".profile__name"),L=document.querySelector(".profile__work"),A=document.querySelector(".popup__form-name"),x=document.querySelector(".popup__form-work"),U=k.querySelector(".popup__button-save");document.querySelector(".profile__edit-button").addEventListener("click",(function(){e(k),A.value=E.textContent,x.value=L.textContent,a(k,o),u(k,o)})),k.querySelector(".popup__form").addEventListener("submit",(function(e){var r,o;e.preventDefault(),g(!0,U),r=A.value,o=x.value,fetch("".concat(m.baseUrl,"/users/me"),{method:"PATCH",headers:m.headers,body:JSON.stringify({name:r,about:o})}).then(b).then((function(e){C(e)})).catch(q),t(k),g(!1,U)}));var w=document.querySelector(".popup_type_place"),T=w.querySelector(".popup__form"),D=w.querySelector(".popup__form-title"),N=w.querySelector(".popup__form-link"),O=document.querySelector(".profile__add-button"),P=w.querySelector(".popup__button-save");O.addEventListener("click",(function(){e(w),u(w,o),T.reset(),a(w,o)})),T.addEventListener("submit",(function(e){var r,o;e.preventDefault(),g(!0,P),r=D.value,o=N.value,fetch("".concat(m.baseUrl,"/cards"),{method:"POST",headers:m.headers,body:JSON.stringify({name:r,link:o})}).then(b).then((function(e){S.prepend(_(e,f))})).catch(q),t(w),e.target.reset(),g(!1,P)}));var J=document.querySelector(".popup_type_avatar"),j=J.querySelector(".popup__form"),I=J.querySelector(".popup__form-input"),M=J.querySelector(".popup__button-save");document.querySelector(".profile__avatar-edit").addEventListener("click",(function(){e(J),j.reset(),a(J,o)})),j.addEventListener("submit",(function(e){var r;e.preventDefault(),g(!0,M),r=I.value,fetch("".concat(m.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:m.headers,body:JSON.stringify({avatar:r})}).then(b).then((function(e){C(e)})).catch(q),t(J),g(!1,M)})),function(e){Array.from(document.querySelectorAll(e.formClass)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.fieldsetClass)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputClass)),o=e.querySelector(t.buttonClass);c(r,o,t),r.forEach((function(a){a.addEventListener("input",(function(){c(r,o,t),function(e,t,r){t.validity.valid?n(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.add(o.inputErrorClass),n.classList.add(o.errorClass),t.validity.valueMissing?n.textContent="Вы пропустили это поле.":t.validity.typeMismatch?n.textContent="Введите адрес сайта.":n.textContent=r}(e,t,t.validationMessage,r)}(e,a,t)}))}))}(t,e)}))}))}(o),fetch("".concat(m.baseUrl,"/users/me"),{headers:m.headers}).then(b).then((function(e){C(e),f=e._id})).catch(q),fetch("".concat(m.baseUrl,"/cards"),{headers:m.headers}).then(b).then((function(e){e.forEach((function(e){S.append(_(e,f))}))})).catch(q)})();